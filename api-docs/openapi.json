{
  "openapi": "3.0.0",
  "info": {
    "title": "SmartMettr Energy Management API",
    "description": "Comprehensive API for smart meter management, billing reports, consumer management, and energy tracking",
    "version": "1.0.0",
    "contact": {
      "name": "SmartMettr Support",
      "email": "support@smartmettr.com"
    }
  },
  "servers": [
    {
      "url": "http://localhost:3000",
      "description": "Development server"
    },
    {
      "url": "https://api.smartmettr.com",
      "description": "Production server"
    }
  ],
  "security": [
    {
      "BearerAuth": []
    }
  ],
  "components": {
    "securitySchemes": {
      "BearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "Clerk JWT token for authentication"
      }
    },
    "schemas": {
      "Error": {
        "type": "object",
        "required": ["success", "message"],
        "properties": {
          "success": {
            "type": "boolean",
            "example": false
          },
          "message": {
            "type": "string",
            "example": "Error message"
          },
          "statusCode": {
            "type": "integer",
            "example": 400
          }
        }
      },
      "PaginationMeta": {
        "type": "object",
        "properties": {
          "page": {
            "type": "integer",
            "example": 1
          },
          "limit": {
            "type": "integer",
            "example": 10
          },
          "total": {
            "type": "integer",
            "example": 50
          },
          "totalPages": {
            "type": "integer",
            "example": 5
          }
        }
      },
      "State": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "code": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "ElectricityBoard": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "code": {
            "type": "string"
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "phone": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "STATE_ADMIN",
              "BOARD_ADMIN",
              "SUPPORT_AGENT",
              "AUDITOR"
            ]
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateUserInput": {
        "type": "object",
        "required": ["name", "role"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "phone": {
            "type": "string"
          },
          "role": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "STATE_ADMIN",
              "BOARD_ADMIN",
              "SUPPORT_AGENT",
              "AUDITOR"
            ]
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "UpdateRoleInput": {
        "type": "object",
        "required": ["role"],
        "properties": {
          "role": {
            "type": "string",
            "enum": [
              "SUPER_ADMIN",
              "STATE_ADMIN",
              "BOARD_ADMIN",
              "SUPPORT_AGENT",
              "AUDITOR"
            ]
          }
        }
      },
      "UpdateScopeInput": {
        "type": "object",
        "properties": {
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "UserConsent": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "consentType": {
            "type": "string",
            "enum": ["ENERGY_TRACKING", "AI_QUERY_PROCESSING"]
          },
          "granted": {
            "type": "boolean"
          },
          "grantedAt": {
            "type": "string",
            "format": "date-time"
          },
          "revokedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "UpdateConsentInput": {
        "type": "object",
        "required": ["consentType", "granted"],
        "properties": {
          "consentType": {
            "type": "string",
            "enum": ["ENERGY_TRACKING", "AI_QUERY_PROCESSING"]
          },
          "granted": {
            "type": "boolean"
          }
        }
      },
      "Consumer": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "phoneNumber": {
            "type": "string"
          },
          "address": {
            "type": "string"
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "RegisterConsumerInput": {
        "type": "object",
        "required": ["name", "address", "stateId", "boardId"],
        "properties": {
          "name": {
            "type": "string"
          },
          "phoneNumber": {
            "type": "string"
          },
          "address": {
            "type": "string"
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "UpdateConsumerInput": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "phoneNumber": {
            "type": "string"
          },
          "address": {
            "type": "string"
          }
        }
      },
      "CustomerConsent": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "consumerId": {
            "type": "string",
            "format": "uuid"
          },
          "consentType": {
            "type": "string",
            "enum": ["ENERGY_TRACKING", "AI_QUERY_PROCESSING"]
          },
          "granted": {
            "type": "boolean"
          },
          "grantedAt": {
            "type": "string",
            "format": "date-time"
          },
          "revokedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SmartMeter": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "meterNumber": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["ACTIVE", "INACTIVE", "FAULTY", "DISCONNECTED"]
          },
          "consumerId": {
            "type": "string",
            "format": "uuid"
          },
          "tariffId": {
            "type": "string",
            "format": "uuid"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateMeterInput": {
        "type": "object",
        "required": ["meterNumber", "tariffId"],
        "properties": {
          "meterNumber": {
            "type": "string"
          },
          "tariffId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "AssignMeterInput": {
        "type": "object",
        "required": ["consumerId"],
        "properties": {
          "consumerId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "UpdateMeterStatusInput": {
        "type": "object",
        "required": ["status"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["ACTIVE", "INACTIVE", "FAULTY", "DISCONNECTED"]
          }
        }
      },
      "MeterReading": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "consumption": {
            "type": "number",
            "format": "float"
          },
          "voltage": {
            "type": "number",
            "format": "float"
          },
          "current": {
            "type": "number",
            "format": "float"
          }
        }
      },
      "ConsumptionSummary": {
        "type": "object",
        "properties": {
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "totalConsumption": {
            "type": "number",
            "format": "float"
          },
          "averageDailyConsumption": {
            "type": "number",
            "format": "float"
          },
          "peakConsumption": {
            "type": "number",
            "format": "float"
          },
          "readingCount": {
            "type": "integer"
          }
        }
      },
      "BillingReport": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "tariffId": {
            "type": "string",
            "format": "uuid"
          },
          "billingStart": {
            "type": "string",
            "format": "date-time"
          },
          "billingEnd": {
            "type": "string",
            "format": "date-time"
          },
          "totalUnits": {
            "type": "number",
            "format": "float"
          },
          "energyCharge": {
            "type": "number",
            "format": "float"
          },
          "fixedCharge": {
            "type": "number",
            "format": "float"
          },
          "taxAmount": {
            "type": "number",
            "format": "float"
          },
          "totalAmount": {
            "type": "number",
            "format": "float"
          },
          "version": {
            "type": "integer"
          },
          "isLatest": {
            "type": "boolean"
          },
          "generatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "GenerateBillingInput": {
        "type": "object",
        "required": ["meterId", "billingStart", "billingEnd"],
        "properties": {
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "billingStart": {
            "type": "string",
            "format": "date-time"
          },
          "billingEnd": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "AggregateInput": {
        "type": "object",
        "required": ["meterId", "periodStart", "periodEnd", "granularity"],
        "properties": {
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "periodStart": {
            "type": "string",
            "format": "date-time"
          },
          "periodEnd": {
            "type": "string",
            "format": "date-time"
          },
          "granularity": {
            "type": "string",
            "enum": ["HOURLY", "DAILY", "MONTHLY"]
          }
        }
      },
      "ConsumptionAggregate": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "meterId": {
            "type": "string",
            "format": "uuid"
          },
          "periodStart": {
            "type": "string",
            "format": "date-time"
          },
          "periodEnd": {
            "type": "string",
            "format": "date-time"
          },
          "granularity": {
            "type": "string",
            "enum": ["HOURLY", "DAILY", "MONTHLY"]
          },
          "totalUnits": {
            "type": "number",
            "format": "float"
          },
          "maxDemand": {
            "type": "number",
            "format": "float"
          },
          "avgVoltage": {
            "type": "number",
            "format": "float"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "RecalculationLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "billingReportId": {
            "type": "string",
            "format": "uuid"
          },
          "reason": {
            "type": "string"
          },
          "triggeredBy": {
            "type": "string"
          },
          "previousVersion": {
            "type": "integer"
          },
          "newVersion": {
            "type": "integer"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "RecalculateBillingInput": {
        "type": "object",
        "required": ["reason"],
        "properties": {
          "reason": {
            "type": "string"
          }
        }
      },
      "CustomerQuery": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "consumerId": {
            "type": "string",
            "format": "uuid"
          },
          "queryText": {
            "type": "string"
          },
          "status": {
            "type": "string",
            "enum": ["PENDING", "AI_REVIEWED", "RESOLVED", "REJECTED"]
          },
          "aiCategory": {
            "type": "string"
          },
          "aiConfidence": {
            "type": "number",
            "format": "float"
          },
          "adminReply": {
            "type": "string"
          },
          "reviewedBy": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateQueryInput": {
        "type": "object",
        "required": ["queryText"],
        "properties": {
          "queryText": {
            "type": "string",
            "minLength": 1,
            "maxLength": 5000
          }
        }
      },
      "UpdateQueryStatusInput": {
        "type": "object",
        "required": ["status"],
        "properties": {
          "status": {
            "type": "string",
            "enum": ["PENDING", "AI_REVIEWED", "RESOLVED", "REJECTED"]
          }
        }
      },
      "AdminReplyInput": {
        "type": "object",
        "required": ["adminReply"],
        "properties": {
          "adminReply": {
            "type": "string",
            "minLength": 1
          },
          "status": {
            "type": "string",
            "enum": ["RESOLVED", "REJECTED"]
          }
        }
      },
      "AiClassifyInput": {
        "type": "object",
        "required": ["category", "confidence"],
        "properties": {
          "category": {
            "type": "string",
            "minLength": 1
          },
          "confidence": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1
          }
        }
      },
      "AiAutoResolveInput": {
        "type": "object",
        "required": ["category", "confidence", "resolutionText"],
        "properties": {
          "category": {
            "type": "string",
            "minLength": 1
          },
          "confidence": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1
          },
          "resolutionText": {
            "type": "string",
            "minLength": 1
          }
        }
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "consumerId": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "type": {
            "type": "string"
          },
          "isRead": {
            "type": "boolean"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateNotificationInput": {
        "type": "object",
        "required": ["consumerId", "title", "message", "type"],
        "properties": {
          "consumerId": {
            "type": "string",
            "format": "uuid"
          },
          "title": {
            "type": "string",
            "minLength": 1
          },
          "message": {
            "type": "string",
            "minLength": 1
          },
          "type": {
            "type": "string"
          }
        }
      },
      "ReportFormat": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "schema": {
            "type": "object"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateReportFormatInput": {
        "type": "object",
        "required": ["boardId", "name", "schema"],
        "properties": {
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string",
            "minLength": 1
          },
          "schema": {
            "type": "object"
          }
        }
      },
      "GeneratedReportFile": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "reportType": {
            "type": "string"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "fileUrl": {
            "type": "string",
            "format": "uri"
          },
          "format": {
            "type": "string",
            "enum": ["PDF", "CSV", "XML", "JSON"]
          },
          "createdBy": {
            "type": "string"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "GenerateReportInput": {
        "type": "object",
        "required": ["reportType", "format"],
        "properties": {
          "reportType": {
            "type": "string",
            "enum": [
              "BILLING_SUMMARY",
              "CONSUMPTION_REPORT",
              "METER_STATUS_REPORT",
              "REVENUE_REPORT"
            ]
          },
          "format": {
            "type": "string",
            "enum": ["PDF", "CSV", "XML", "JSON"]
          },
          "filters": {
            "type": "object",
            "properties": {
              "billingStart": {
                "type": "string",
                "format": "date-time"
              },
              "billingEnd": {
                "type": "string",
                "format": "date-time"
              },
              "consumerId": {
                "type": "string",
                "format": "uuid"
              },
              "meterId": {
                "type": "string",
                "format": "uuid"
              }
            }
          }
        }
      },
      "AuditLog": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "userId": {
            "type": "string",
            "format": "uuid"
          },
          "action": {
            "type": "string"
          },
          "entity": {
            "type": "string"
          },
          "entityId": {
            "type": "string",
            "format": "uuid"
          },
          "metadata": {
            "type": "object"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "DataRetentionPolicy": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid"
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "entityType": {
            "type": "string",
            "enum": [
              "MeterReading",
              "AuditLog",
              "GeneratedReportFile",
              "CustomerQuery"
            ]
          },
          "retentionDays": {
            "type": "integer",
            "minimum": 1
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "CreateRetentionPolicyInput": {
        "type": "object",
        "required": ["entityType", "retentionDays"],
        "properties": {
          "stateId": {
            "type": "string",
            "format": "uuid"
          },
          "boardId": {
            "type": "string",
            "format": "uuid"
          },
          "entityType": {
            "type": "string",
            "enum": [
              "MeterReading",
              "AuditLog",
              "GeneratedReportFile",
              "CustomerQuery"
            ]
          },
          "retentionDays": {
            "type": "integer",
            "minimum": 1
          }
        }
      },
      "UpdateRetentionPolicyInput": {
        "type": "object",
        "properties": {
          "entityType": {
            "type": "string",
            "enum": [
              "MeterReading",
              "AuditLog",
              "GeneratedReportFile",
              "CustomerQuery"
            ]
          },
          "retentionDays": {
            "type": "integer",
            "minimum": 1
          }
        }
      },
      "CreateStateInput": {
        "type": "object",
        "required": ["name", "code"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "code": {
            "type": "string",
            "minLength": 1
          }
        }
      },
      "CreateBoardInput": {
        "type": "object",
        "required": ["name", "code", "stateId"],
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "code": {
            "type": "string",
            "minLength": 1
          },
          "stateId": {
            "type": "string",
            "format": "uuid"
          }
        }
      },
      "UpdateBoardInput": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "code": {
            "type": "string",
            "minLength": 1
          }
        }
      }
    }
  },
  "paths": {
    "/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Health check endpoint",
        "operationId": "healthCheck",
        "security": [],
        "responses": {
          "200": {
            "description": "Server is healthy",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "example": "ok"
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users": {
      "post": {
        "tags": ["Users"],
        "summary": "Create a new admin user",
        "operationId": "createUser",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateUserInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Bad request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Users"],
        "summary": "List users (paginated, scope-filtered)",
        "operationId": "listUsers",
        "parameters": [
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "SUPER_ADMIN",
                "STATE_ADMIN",
                "BOARD_ADMIN",
                "SUPPORT_AGENT",
                "AUDITOR"
              ]
            }
          },
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of users",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/User"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}": {
      "get": {
        "tags": ["Users"],
        "summary": "Get a user by ID",
        "operationId": "getUserById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Users"],
        "summary": "Delete a user",
        "operationId": "deleteUser",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User deleted successfully"
          }
        }
      }
    },
    "/api/users/{id}/role": {
      "patch": {
        "tags": ["Users"],
        "summary": "Update user role",
        "operationId": "updateUserRole",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRoleInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User role updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}/scope": {
      "patch": {
        "tags": ["Users"],
        "summary": "Update user scope (stateId/boardId)",
        "operationId": "updateUserScope",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateScopeInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User scope updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/User"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/users/{id}/consents": {
      "get": {
        "tags": ["Users", "Consents"],
        "summary": "List consents for a user",
        "operationId": "listUserConsents",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User consents",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/UserConsent"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": ["Users", "Consents"],
        "summary": "Update user consent",
        "operationId": "updateUserConsent",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateConsentInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Consent updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/UserConsent"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/register": {
      "post": {
        "tags": ["Consumers"],
        "summary": "Register as a new consumer",
        "operationId": "registerConsumer",
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterConsumerInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Consumer registered",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Consumer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/me": {
      "get": {
        "tags": ["Consumers"],
        "summary": "Get consumer profile (self)",
        "operationId": "getConsumerProfile",
        "responses": {
          "200": {
            "description": "Consumer profile",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Consumer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": ["Consumers"],
        "summary": "Update own consumer profile",
        "operationId": "updateConsumerProfile",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateConsumerInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Profile updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Consumer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/me/consents": {
      "get": {
        "tags": ["Consumers", "Consents"],
        "summary": "View own consents",
        "operationId": "getMyConsents",
        "responses": {
          "200": {
            "description": "Consumer consents",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/CustomerConsent"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/me/consents/{consentType}/grant": {
      "post": {
        "tags": ["Consumers", "Consents"],
        "summary": "Grant a consent",
        "operationId": "grantConsent",
        "parameters": [
          {
            "name": "consentType",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["ENERGY_TRACKING", "AI_QUERY_PROCESSING"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consent granted",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerConsent"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/me/consents/{consentType}/revoke": {
      "post": {
        "tags": ["Consumers", "Consents"],
        "summary": "Revoke a consent",
        "operationId": "revokeConsent",
        "parameters": [
          {
            "name": "consentType",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "enum": ["ENERGY_TRACKING", "AI_QUERY_PROCESSING"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consent revoked",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerConsent"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers": {
      "get": {
        "tags": ["Consumers"],
        "summary": "List consumers (admin only)",
        "operationId": "listConsumers",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of consumers",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Consumer"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/consumers/{consumerId}": {
      "get": {
        "tags": ["Consumers"],
        "summary": "Get consumer by ID",
        "operationId": "getConsumerById",
        "parameters": [
          {
            "name": "consumerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consumer found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Consumer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": ["Consumers"],
        "summary": "Update a consumer (admin only)",
        "operationId": "updateConsumer",
        "parameters": [
          {
            "name": "consumerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateConsumerInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Consumer updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Consumer"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Consumers"],
        "summary": "Delete a consumer",
        "operationId": "deleteConsumer",
        "parameters": [
          {
            "name": "consumerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consumer deleted"
          }
        }
      }
    },
    "/api/smart-meters": {
      "post": {
        "tags": ["Smart Meters"],
        "summary": "Create a new smart meter",
        "operationId": "createSmartMeter",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateMeterInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Meter created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SmartMeter"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/smart-meters/{meterId}": {
      "get": {
        "tags": ["Smart Meters"],
        "summary": "Get meter by ID",
        "operationId": "getSmartMeterById",
        "parameters": [
          {
            "name": "meterId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Meter found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SmartMeter"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/smart-meters/{meterId}/assign": {
      "patch": {
        "tags": ["Smart Meters"],
        "summary": "Assign meter to consumer",
        "operationId": "assignSmartMeter",
        "parameters": [
          {
            "name": "meterId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AssignMeterInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Meter assigned",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SmartMeter"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/smart-meters/consumer/{consumerId}": {
      "get": {
        "tags": ["Smart Meters"],
        "summary": "Get all meters for a consumer",
        "operationId": "getSmartMetersByConsumer",
        "parameters": [
          {
            "name": "consumerId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of meters",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/SmartMeter"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/smart-meters/{meterId}/status": {
      "patch": {
        "tags": ["Smart Meters"],
        "summary": "Update meter status",
        "operationId": "updateSmartMeterStatus",
        "parameters": [
          {
            "name": "meterId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateMeterStatusInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/SmartMeter"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/smart-meters/{meterId}/consumption": {
      "get": {
        "tags": ["Smart Meters"],
        "summary": "Get consumption summary",
        "operationId": "getConsumptionSummary",
        "parameters": [
          {
            "name": "meterId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Consumption summary",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ConsumptionSummary"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/generate": {
      "post": {
        "tags": ["Billing"],
        "summary": "Generate a billing report for a meter",
        "operationId": "generateBillingReport",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateBillingInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Billing report generated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/BillingReport"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/aggregate": {
      "post": {
        "tags": ["Billing"],
        "summary": "Build/refresh a consumption aggregate",
        "operationId": "aggregateConsumption",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AggregateInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Aggregate created/updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ConsumptionAggregate"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing": {
      "get": {
        "tags": ["Billing"],
        "summary": "List billing reports (paginated, filtered)",
        "operationId": "listBillingReports",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of billing reports",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/BillingReport"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/meter/{meterId}/aggregates": {
      "get": {
        "tags": ["Billing"],
        "summary": "Get consumption aggregates for a meter",
        "operationId": "getAggregates",
        "parameters": [
          {
            "name": "meterId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of aggregates",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ConsumptionAggregate"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/{billId}": {
      "get": {
        "tags": ["Billing"],
        "summary": "Get a single billing report by ID",
        "operationId": "getBillingReportById",
        "parameters": [
          {
            "name": "billId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Billing report found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/BillingReport"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/{billId}/recalculate": {
      "post": {
        "tags": ["Billing"],
        "summary": "Recalculate an existing billing report",
        "operationId": "recalculateBillingReport",
        "parameters": [
          {
            "name": "billId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RecalculateBillingInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Billing report recalculated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/BillingReport"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/{billId}/recalculations": {
      "get": {
        "tags": ["Billing"],
        "summary": "Get recalculation history",
        "operationId": "getRecalculations",
        "parameters": [
          {
            "name": "billId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Recalculation history",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/RecalculationLog"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/billing/{billId}/view": {
      "post": {
        "tags": ["Billing"],
        "summary": "Consumer records viewing a bill",
        "operationId": "recordBillView",
        "parameters": [
          {
            "name": "billId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "View recorded"
          }
        }
      }
    },
    "/api/queries": {
      "post": {
        "tags": ["Queries"],
        "summary": "Consumer submits a new query",
        "operationId": "createQuery",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateQueryInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Query created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerQuery"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Queries"],
        "summary": "Admin lists all queries (paginated, filtered)",
        "operationId": "listQueries",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of queries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/CustomerQuery"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/me": {
      "get": {
        "tags": ["Queries"],
        "summary": "Consumer lists their own queries",
        "operationId": "listMyQueries",
        "responses": {
          "200": {
            "description": "List of consumer's queries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/CustomerQuery"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/{id}/status": {
      "patch": {
        "tags": ["Queries"],
        "summary": "Admin updates query status",
        "operationId": "updateQueryStatus",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateQueryStatusInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Status updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerQuery"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/{id}/reply": {
      "patch": {
        "tags": ["Queries"],
        "summary": "Admin replies to a query",
        "operationId": "replyToQuery",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminReplyInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reply recorded",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerQuery"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/{id}": {
      "delete": {
        "tags": ["Queries"],
        "summary": "Admin deletes a query",
        "operationId": "deleteQuery",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Query deleted"
          }
        }
      }
    },
    "/api/queries/ai/pending": {
      "get": {
        "tags": ["Queries", "AI"],
        "summary": "Fetch PENDING queries for AI processing",
        "operationId": "fetchPendingForAi",
        "responses": {
          "200": {
            "description": "Pending queries",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/CustomerQuery"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/{id}/ai-classify": {
      "patch": {
        "tags": ["Queries", "AI"],
        "summary": "AI classifies a query",
        "operationId": "classifyQuery",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AiClassifyInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Query classified",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerQuery"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/queries/{id}/ai-resolve": {
      "patch": {
        "tags": ["Queries", "AI"],
        "summary": "AI auto-resolves a query",
        "operationId": "autoResolveQuery",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AiAutoResolveInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Query auto-resolved",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/CustomerQuery"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/notifications": {
      "get": {
        "tags": ["Notifications"],
        "summary": "Consumer lists their own notifications",
        "operationId": "listMyNotifications",
        "responses": {
          "200": {
            "description": "List of notifications",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Notification"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "post": {
        "tags": ["Notifications"],
        "summary": "Admin creates a notification for a consumer",
        "operationId": "createNotification",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateNotificationInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Notification created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/Notification"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/notifications/admin": {
      "get": {
        "tags": ["Notifications"],
        "summary": "Admin lists all notifications (scope-filtered)",
        "operationId": "listAllNotifications",
        "responses": {
          "200": {
            "description": "List of all notifications",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/Notification"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/notifications/{id}": {
      "delete": {
        "tags": ["Notifications"],
        "summary": "Delete a notification",
        "operationId": "deleteNotification",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Notification deleted"
          }
        }
      }
    },
    "/api/notifications/read-all": {
      "patch": {
        "tags": ["Notifications"],
        "summary": "Consumer marks all notifications as read",
        "operationId": "markAllNotificationsAsRead",
        "responses": {
          "200": {
            "description": "All marked as read"
          }
        }
      }
    },
    "/api/notifications/{id}/read": {
      "patch": {
        "tags": ["Notifications"],
        "summary": "Consumer marks a notification as read",
        "operationId": "markNotificationAsRead",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Marked as read"
          }
        }
      }
    },
    "/api/reports/formats": {
      "post": {
        "tags": ["Reports"],
        "summary": "Create a report format template",
        "operationId": "createReportFormat",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateReportFormatInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Report format created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ReportFormat"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Reports"],
        "summary": "List report formats (scope-filtered)",
        "operationId": "listReportFormats",
        "responses": {
          "200": {
            "description": "List of report formats",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ReportFormat"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reports/generate": {
      "post": {
        "tags": ["Reports"],
        "summary": "Generate a report file",
        "operationId": "generateReport",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenerateReportInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Report generated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/GeneratedReportFile"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reports": {
      "get": {
        "tags": ["Reports"],
        "summary": "List generated reports (paginated, scope-filtered)",
        "operationId": "listReports",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of reports",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/GeneratedReportFile"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reports/{id}/download": {
      "get": {
        "tags": ["Reports"],
        "summary": "Download a report file",
        "operationId": "downloadReport",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "File download",
            "content": {
              "application/octet-stream": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          }
        }
      }
    },
    "/api/reports/{id}": {
      "delete": {
        "tags": ["Reports"],
        "summary": "Delete a report",
        "operationId": "deleteReport",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Report deleted"
          }
        }
      }
    },
    "/api/audit": {
      "get": {
        "tags": ["Audit"],
        "summary": "List audit logs (paginated, filtered)",
        "operationId": "listAuditLogs",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "List of audit logs",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/AuditLog"
                      }
                    },
                    "meta": {
                      "$ref": "#/components/schemas/PaginationMeta"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/audit/export/csv": {
      "get": {
        "tags": ["Audit"],
        "summary": "Export audit logs as CSV",
        "operationId": "exportAuditCsv",
        "responses": {
          "200": {
            "description": "CSV file",
            "content": {
              "text/csv": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    },
    "/api/audit/{id}": {
      "get": {
        "tags": ["Audit"],
        "summary": "Get a single audit log by ID",
        "operationId": "getAuditLogById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Audit log found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/AuditLog"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reference/states": {
      "post": {
        "tags": ["Reference"],
        "summary": "Create a state",
        "operationId": "createState",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateStateInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "State created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/State"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Reference"],
        "summary": "List states (scope-filtered)",
        "operationId": "listStates",
        "responses": {
          "200": {
            "description": "List of states",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/State"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reference/boards": {
      "post": {
        "tags": ["Reference"],
        "summary": "Create an electricity board",
        "operationId": "createBoard",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateBoardInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Board created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ElectricityBoard"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Reference"],
        "summary": "List electricity boards (scope-filtered)",
        "operationId": "listBoards",
        "responses": {
          "200": {
            "description": "List of boards",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/ElectricityBoard"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/reference/boards/{id}": {
      "get": {
        "tags": ["Reference"],
        "summary": "Get board by ID",
        "operationId": "getBoardById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Board found",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ElectricityBoard"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "patch": {
        "tags": ["Reference"],
        "summary": "Update a board",
        "operationId": "updateBoard",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateBoardInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Board updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/ElectricityBoard"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Reference"],
        "summary": "Delete a board",
        "operationId": "deleteBoard",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Board deleted"
          }
        }
      }
    },
    "/api/retention": {
      "post": {
        "tags": ["Retention"],
        "summary": "Create a retention policy",
        "operationId": "createRetentionPolicy",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateRetentionPolicyInput"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Retention policy created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/DataRetentionPolicy"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Retention"],
        "summary": "List retention policies (scope-filtered)",
        "operationId": "listRetentionPolicies",
        "responses": {
          "200": {
            "description": "List of retention policies",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "#/components/schemas/DataRetentionPolicy"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/retention/{id}": {
      "patch": {
        "tags": ["Retention"],
        "summary": "Update a retention policy",
        "operationId": "updateRetentionPolicy",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateRetentionPolicyInput"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Policy updated",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "$ref": "#/components/schemas/DataRetentionPolicy"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": ["Retention"],
        "summary": "Delete a retention policy",
        "operationId": "deleteRetentionPolicy",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string",
              "format": "uuid"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Policy deleted"
          }
        }
      }
    },
    "/api/retention/cleanup/run": {
      "post": {
        "tags": ["Retention"],
        "summary": "Trigger retention cleanup",
        "operationId": "runCleanup",
        "responses": {
          "200": {
            "description": "Cleanup triggered"
          }
        }
      }
    }
  }
}
